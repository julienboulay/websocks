<!DOCTYPE HTML>
<html>

<head>
	<script type="text/javascript" src="socket.io/socket.io.js"></script>
	<script type="text/javascript" src="js/canvasjs.min.js"></script>
	
	<script type="text/javascript">
	
	var startTime;
	var lrChart;
	var fbChart;
	
	window.onload = function () {

		lrChart = createOrientationChart("lrChart", "Left-Right Orientation");
		fbChart = createOrientationChart("fbChart", "Front-Back Orientation");

		startTime =  new Date().getTime();

		var socket = io.connect(document.location.host);
		
		
		socket.on('deviceOrientation', deviceOrientationListener);

	}
	
	function createOrientationChart(chartName, title)
	{
	      var orientationChart = new CanvasJS.Chart(chartName,{
			zoomEnabled: true,
			title: {
				text: title		
			},
			toolTip: {
				shared: true,
				
			},
			legend: {
				verticalAlign: "top",
				horizontalAlign: "center",
                                fontSize: 14,
				fontWeight: "bold",
				fontFamily: "calibri",
				fontColor: "dimGrey"
			},
			axisX: {
				title: "time (in millisecond)"
			},
			axisY:{
				title: "orientation (in degrees)",
			}, 
			data: []
		});
		
		return orientationChart;
	}
	
	
	function deviceOrientationListener(eventData)
	{
	    var time = new Date();
	    time.setTime(new Date().getTime() - startTime);
	    
	    if (time < 60000)
	    {
		var id = eventData.id;
	      
		tiltLRValue = eventData.tiltLR;
		tiltFBValue = eventData.tiltFB;
		
		if (lrChart.options.data[id] == null)
		{
		  lrChart.options.data[id] = { 
				// dataSeries n°id
				markerType: "none",
				type: "spline",
				xValueType: "number",
				showInLegend: true,
				name: "Smartphone " + id,
				dataPoints: []
			};
		}
		
		lrChart.options.data[id].dataPoints.push({
			x: time.getTime(),
			y: tiltLRValue,
		});
		
		if (fbChart.options.data[id] == null)
		{
		  fbChart.options.data[id] = { 
				// dataSeries n°id
				markerType: "none",
				type: "spline",
				xValueType: "number",
				showInLegend: true,
				name: "Smartphone " + id,
				dataPoints: []
			};
		}
		
		fbChart.options.data[id].dataPoints.push({
			x: time.getTime(),
			y: tiltFBValue,
		});
		
		lrChart.render();
		fbChart.render();
	    }
	}
	</script>
	
</head>
<body>
	<div id="lrChart" style="height: 300px; width: 100%;">
	</div>
	<div id="fbChart" style="height: 300px; width: 100%;">
	</div>
</body>
</html>
